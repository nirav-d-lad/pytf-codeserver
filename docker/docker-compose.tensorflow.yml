services:
  tensorflow:

    # Docker image pulled from registry
    image: oper785/tensorflow-codium:latest

    # Always pull newest image before starting
    pull_policy: always

    # Enable NVIDIA GPU access (modern Docker Compose way)
    gpus: all

    # Map host port -> container port 8080
    ports:
      - "8080"
      
    # Mount current directory into container workspace
    volumes:
      - ./:/workspace

    # Default working directory inside container
    working_dir: /workspace

    # Increase shared memory (important for TF, dataloaders, multiprocessing)
    shm_size: "2gb"

    # GPU visibility + driver capabilities (optional but safe)
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility

    # Keep terminal interactive (useful for exec/bash)
    stdin_open: true
    tty: true

    # Restart automatically unless manually stopped
    restart: unless-stopped
